function initsidecutout(x, y, sideindex) {
    let side = shape.sides[sideindex];
    let cw = 120; ch = 72, holes = 1;
    let cutout = {};
    let index = side.cutouts.length;
    cutout.index = index, cutout.shapeindex = shape.index, cutout.type = cutouttype, cutout.itemid = cutoutinfo.ID, cutout.sideindex = sideindex, cutout.spcutoutindex = index, cutout.angle = 0, cutout.Isactive = 1;
    cutout.x = x, cutout.y = y, cutout.w = cw, cutout.h = ch, cutout.dx = 0, cutout.dy = 0, cutout.cutoutshape = cutoutinfo.Code;
    if (cutoutinfo.Width != 0 && cutoutinfo.Height != 0) { cw = cutoutinfo.Width * scale; ch = cutoutinfo.Height * scale; }
    cutout.w = cw, cutout.h = ch, cutout.holes = cutoutinfo.NoOfBowls;  
    side.cutouts.push(cutout);    
}
function initcutoutg(index, sideindex) {
    let sindex = shape.index, smode = shape.mode, partsrno = shape.partsrno, areaid = shape.areaid, spindex = shape.spindex;
    let cindex = sindex + "" + sideindex + "" + index;
    let cutoutg = cutoutsg.select("#" + smode + "cutoutg" + cindex);
    if (!cutoutg.empty()) { cutoutg.remove(); }
    cutoutg = cutoutsg.append("g").attr("id", smode + "cutoutg" + cindex);
    cutoutg.attr("index", index).attr("sideindex", sideindex).attr("sindex", sindex).attr("spindex", spindex).attr("partsrno", partsrno).attr("areaid", areaid).attr("smode", smode);
    if (shape.mode == 'shape') { cutoutg.call(cutoutdrag); } else if (shape.mode == 'slabpart') { cutoutg.attr("pointer-events", "none") }
    return cutoutg;
}
function initcutoutmarkerg(index, sideindex) {
    let sindex = shape.index, smode = shape.mode, partsrno = shape.partsrno, areaid = shape.areaid, spindex = shape.spindex;
    let cindex = sindex + "" + sideindex + "" + index;
    let cutoutmarkerg = cutoutsg.select("#" + smode + "cutoutmarkerg" + cindex);
    if (cutoutmarkerg.empty()) { cutoutmarkerg = cutoutsg.append("g").attr("id", smode + "cutoutmarkerg" + cindex); }    
    cutoutmarkerg.attr("index", index).attr("sideindex", sideindex).attr("sindex", sindex).attr("spindex", spindex).attr("partsrno", partsrno).attr("areaid", areaid).attr("smode", smode);
    return cutoutmarkerg;
}
function resetshapecutouts(source) {    
    for (let j = 0; j < shape.sides.length; j++) {
        setsidecutouts(j);
    }
}
function setsidecutouts(sideindex, sindex) {
    for (let j = 0; j < shape.sides[sideindex].cutouts.length; j++) {
        if (shape.sides[sideindex].cutouts[j].Isactive == 1) {           
            setcutoutcoords1(j, sideindex);
            setcutoutangle(j, sideindex);
            drawsidecutout32(j, sideindex);
        }
    }
}

function sidecutoutcount(side) {
    let count = 0;
    for (let i = 0; i < side.cutouts.length - 1; i++) {
        if (side.cutouts[i].Isactive == 1) { count++; }
    }
    return count;
}
function setcutoutangle(index, sideindex) {
    let side = shape.sides[sideindex];
    let cutout = side.cutouts[index];
    let x1 = side.x1, y1 = side.y1, x2 = side.x2, y2 = side.y2, w1 = side.w1, w2 = side.w2;
    let sideangle = calclineangle2(x1, y1, x2, y2, 'calcutoutangle');
    if (sideangle >= 180) { sideangle = 180 - sideangle; } else if (sideangle > 90) { sideangle = 180 - sideangle; }
    if (w1 > w2) { sideangle = -sideangle; }
    cutout.angle = sideangle;
}
function setsidecutout(x, y, index, sideindex) {
    x = Math.round(x), y = Math.round(y);
    let index1 = index;
    let side = shape.sides[sideindex];
    let x1 = side.x1, y1 = side.y1, x2 = side.x2, y2 = side.y2, w1 = side.w1, w2 = side.w2;   
    let sideangle = calclineangle2(x1, y1, x2, y2, 'calcutoutangle');   
    if (index == -1) {
        index = side.cutouts.length;
        initsidecutout(x, y, sideindex);
        ActionSinkCutout(cutoutinfo.SinkID, 'setsidecutout');//sink cutout
    }
    //console.log(x, y, index, sideindex, side.cutouts.length);
    let cutout = side.cutouts[index];
    if (cutout != undefined) {
        if (cutout.index != index) { cutout.index = index; } //reindex     
        if (index1 == -1) {
            cutout.x = x; cutout.y = y;
            setcutoutcoords(index, sideindex);         
            setcutoutangle(index, sideindex);
        }
        else {            
            setcutoutcoords(index, sideindex);
        }        
    }
    return index;
}
function setcutoutcoords(index, sideindex) {
    let source = 'setcutoutcoords';
    let side = shape.sides[sideindex];
    let cutout = side.cutouts[index], cx = cutout.x, cy = cutout.y, cw = cutout.w, ch = cutout.h, cdw = cutout.dw, cdh = cutout.dh, cmtype = cutout.measuretype;
    let x1 = side.x1, y1 = side.y1, x2 = side.x2, y2 = side.y2;
    let x11 = side.x11, y11 = side.y11, x12 = side.x12, y12 = side.y12, w1 = applymminchfact(side.w1, 1, 2, source), h = applymminchfact1(side.h, 1, 2, source);
    let x21 = side.x21, y21 = side.y21, x22 = side.x22, y22 = side.y22, w2 = applymminchfact(side.w2, 1, 2, source);
    let cx1 = 0, cy1 = 0, cx2 = 0, cy2 = 0, cx3 = 0, cy3 = 0;
    if (cmtype == undefined) { cmtype = 1; cutout.measuretype = cmtype; }
    if (cmtype == 3) {
        if (w1 >= w2) { cx1 = x22, cy1 = y22, cx2 = x21, cy2 = y21; } else { cx1 = x11, cy1 = y11, cx2 = x12, cy2 = y12; }
    } else { if (w1 >= w2) { cx1 = x21, cy1 = y21, cx2 = x22, cy2 = y22; } else { cx1 = x11, cy1 = y11, cx2 = x11, cy2 = y11;} }
    let npt = calcverticalvectorpoint(cx1, cy1, cx2, cy2, cx, cy);
    cx3 = npt.dx, cy3 = npt.dy;   
    cutout.dw = roundToTwo(calchyplen(cx1, cy1, cx3, cy3));
    cutout.dh = roundToTwo(calchyplen(cx3, cy3, cx, cy));
}
function setcutoutcoords1(index, sideindex) {//called  on shape angle change
    let source = 'setcutoutcoords1';
    let side = shape.sides[sideindex];
    let cutout = side.cutouts[index], cx = cutout.x, cy = cutout.y, cw = cutout.w, ch = cutout.h, cdw = cutout.dw, cdh = cutout.dh, cmtype = cutout.measuretype;
    let x1 = side.x1, y1 = side.y1, x2 = side.x2, y2 = side.y2;
    let x11 = side.x11, y11 = side.y11, x12 = side.x12, y12 = side.y12, w1 = applymminchfact(side.w1, 1, 2, source), h = applymminchfact1(side.h, 1, 2, source);
    let x21 = side.x21, y21 = side.y21, x22 = side.x22, y22 = side.y22, w2 = applymminchfact(side.w2, 1, 2, source);
    let cx1 = 0, cy1 = 0, cx2 = 0, cy2 = 0, cx3 = 0, cy3 = 0;
    if (cmtype == undefined) { cmtype = 1; cutout.measuretype = cmtype; }
    let sideangle = calclineangle2(x1, y1, x2, y2, source);    
    if (cmtype == 3) {
        if (w1 >= w2) { cx1 = x22, cy1 = y22, cx2 = x21, cy2 = y21; } else { cx1 = x11, cy1 = y11, cx2 = x12, cy2 = y12; }
    } else { if (w1 >= w2) { cx1 = x21, cy1 = y21, cx2 = x22, cy2 = y22; } else { cx1 = x11, cy1 = y11, cx2 = x11, cy2 = y11; } }
    let sideangle1 = calclineangle2(cx1, cy1, cx2, cy2, source);
    let npt = rotate_point1(cx1, cy1, -1, sideangle, cdw);
    cx3 = npt.dx, cy3 = npt.dy;
    npt = rotate_point1(cx3, cy3, -1, sideangle1, cdh);
    cx = npt.dx, cy = npt.dy;
    cutout.x = cx, cutout.y = cy;    
    cutout.dw = roundToTwo(calchyplen(cx1, cy1, cx3, cy3));
    cutout.dh = roundToTwo(calchyplen(cx3, cy3, cx, cy));
}
function cutoutmeasuretype34(index, sideindex, mtype) {
    let source = 'aligncutout34';    
    let objVal = $('#shapectlcutoutdist' + index).val().split(" ");
    let cdw1 = parseFloat(fractionToDecimal(objVal[0])) + parseFloat(fractionToDecimal(objVal[1]));
    if (isNaN(cdw1)) { return; }
    cdw1 = applymminchfact1(cdw1, 1, 2, source);
    let side = shape.sides[sideindex];
    let cutout = side.cutouts[index], cx = cutout.x, cy = cutout.y, cw = cutout.w, ch = cutout.h, cdw = cutout.dw, cdh = cutout.dh, cmtype = cutout.measuretype;
    let x1 = side.x1, y1 = side.y1, x2 = side.x2, y2 = side.y2;
    let x11 = side.x11, y11 = side.y11, x12 = side.x12, y12 = side.y12, w1 = applymminchfact(side.w1, 1, 2, source), h = applymminchfact1(side.h, 1, 2, source);
    let x21 = side.x21, y21 = side.y21, x22 = side.x22, y22 = side.y22, w2 = applymminchfact(side.w2, 1, 2, source);
    let cx1 = 0, cy1 = 0, cx2 = 0, cy2 = 0, cx3 = 0, cy3 = 0;
    if (w1 >= w2) { cx1 = x21, cy1 = y21, cx2 = (x21 + x22) / 2; cy2 = (y21 + y22) / 2; } else { cx1 = x11, cy1 = y11, cx2 = (x11 + x12) / 2; cy2 = (y11 + y12) / 2; }
    if (cmtype == undefined) { cmtype = 1; }
    if (mtype != 0) { cmtype = mtype; }   
    if (cmtype == 3) { if (w1 >= w2) { cx1 = x22, cy1 = y22; } else { cx1 = x12, cy1 = y12; } }
    if (cmtype != 2) {
        let angle = calclineangle2(cx1, cy1, cx2, cy2, source);
        let npt = rotate_point1(cx1, cy1, -1, angle, cdw1);
        cx2 = npt.dx, cy2 = npt.dy;
    }
    let npt1 = calcverticalvectorpoint(x1, y1, x2, y2, cx2, cy2);
    cx3 = npt1.dx, cy3 = npt1.dy;
    cutout.x = cx3; cutout.y = cy3;    
    cdw = calchyplen(cx1, cy1, cx2, cy2);
    //cdh = calchyplen(cx2, cy2, cx3, cy3);
    //cutout.dw = roundToTwo(cdw);
    //cutout.dh = roundToTwo(cdh);
    if (cmtype != 0) { cutout.measuretype = cmtype; }
    if (cmtype == 2) { $('#shapectlcutoutdist' + index).val(applymminchfact1(cdw, 2, 2, source));}
    setcutoutmeasuretypestyles34(index, cmtype);
    //console.log(index, sideindex, mtype, cdw, cdw1, cmtype, cutout.measuretype, fractionToDecimal(objVal[0]), fractionToDecimal(objVal[1]));
}
function centercutout(index, sideindex) {
    let source = 'centercutout'
    let side = shape.sides[sideindex];
    let cutout = side.cutouts[index];
    let x1 = side.x1, y1 = side.y1, x2 = side.x2, y2 = side.y2;
    let x11 = side.x11, y11 = side.y11, x12 = side.x12, y12 = side.y12, w1 = applymminchfact(side.w1, 1, 2, source), h = applymminchfact1(side.h, 1, 2, source);
    let x21 = side.x21, y21 = side.y21, x22 = side.x22, y22 = side.y22, w2 = applymminchfact(side.w2, 1, 2, source);
    let cx1 = 0, cy1 = 0, cx2 = 0, cy2 = 0, cx3 = 0, cy3 = 0;
    if (w1 >= w2) { cx1 = x21, cy1 = y21, cx2 = (x21 + x22) / 2; cy2 = (y21 + y22) / 2; } else { cx1 = x11, cy1 = y11, cx2 = (x11 + x12) / 2; cy2 = (y11 + y12) / 2; }    
    for (let i = 0; i < side.cutouts.length - 1; i++) {
        if (side.cutouts[i].Isactive == 1) { cx2 += side.cutouts[i].w / 2; }        
    }
    let npt1 = calcverticalvectorpoint(x1, y1, x2, y2, cx2, cy2);
    cx3 = npt1.dx, cy3 = npt1.dy;   
    cutout.x = cx3; cutout.y = cy3;   
    cutout.dw = roundToTwo(calchyplen(cx1, cy1, cx2, cy2));
    cutout.dh = roundToTwo(calchyplen(cx2, cy2, cx3, cy3));
}
function onsetshapesidecutout(x, y, index, sideindex, sindex, source) {    
    let index1 = setsidecutout(x, y, index, sideindex); 
    drawsidecutout32(index1, sideindex);    
    ActionCutout(source);
}
function onsetshapesidecutout1(x, y, index, sideindex, sindex) {    
    setsidecutout(x, y, index, sideindex);
    drawsidecutout32(index, sideindex);
}
function onsetshapesidecutouts(sideindex, sindex) {
    setsidecutouts(sideindex, sindex);
}
function oncutoutcontextmenu() {    
    removeshapetools();
    let m = d3.mouse(this);
    d3.event.preventDefault();
    let mode = this.getAttribute("smode");
    if (mode == 'shape') {
        let index = parseInt(this.getAttribute("index"));
        let sideindex = parseInt(this.getAttribute("sideindex"));
        let sindex = parseInt(this.getAttribute("sindex"));
        let spindex = parseInt(this.getAttribute("spindex"));
        let partsrno = parseInt(this.getAttribute("partsrno"));
        let areaid = parseInt(this.getAttribute("areaid"));
       // console.log(index, sideindex, sindex, spindex, partsrno, areaid);
        setdrawshape31(sindex, partsrno, areaid, mode, 'oncutoutcontextmenu');       
        let side = shape.sides[sideindex];
        let cutout = side.cutouts[index];
        drawcutoutcontrols(index, sideindex, m[0], m[1]);
    }
}
function onrotatecutout(type, index, sideindex, angle) {
    let side = shape.sides[sideindex];
    let cutout = side.cutouts[index];
    let angle1 = cutout.angle;
    if (type == 0) { angle1 = angle; } else if (type == 1) { angle1 += angle; } else if (type == -1) { angle1 -= angle; }    
    if (angle1 <= 180 && angle1 >= -180) {
        cutout.angle = angle1;       
        rotatecutout(index, sideindex);
        if (shape.mode == 'shape') { ActionUpdateShape('onrotatecutout'); }          
    }
   
}
function rotatecutout(index, sideindex) {
    let smode = shape.mode, sindex = shape.index;
    let areashapeindex = shape.areaid + "" + index;
    let side = shape.sides[sideindex];
    let cutout = side.cutouts[index];
    let cindex = sindex + "" + sideindex + "" + index;
    let cutoutg = cutoutsg.select("#" + smode + "cutoutg" + cindex);    
    if (!cutoutg.empty()) {
        let cx = 0, cy = 0;
        let gnode = cutoutg.node();
        cx = gnode.getBBox().x + gnode.getBBox().width / 2; cy = gnode.getBBox().y + gnode.getBBox().height / 2;
        let npt = [cx.toFixed(), cy.toFixed()];
        cutoutg.attr("transform", "rotate(" + cutout.angle + "," + npt + ")");
        $('#shapectlinputangle' + areashapeindex).val(cutout.angle);
        //let cmindex = sindex + "" + sideindex + "" + index;
        //let cmarkerg = cutoutg.select("#" + smode + "cmarkerg" + cmindex);
        //if (!cmarkerg.empty()) { cmarkerg.attr("transform", "rotate(" + -cutout.angle + "," + npt + ")"); }        
    }
}
function rotatesidecutouts(sideindex) {
    var side = shape.sides[sideindex];
    var angle = side.angle;
    for (var j = 0; j < side.cutouts.length; j++) {
        rotatecutout(j, sideindex)
    }
}
function oncutoutmeasuretype34(index, sideindex, type) {
    cutoutmeasuretype34(index, sideindex, type);
    onsetshapesidecutout(0, 0, index, sideindex, shape.index);
}
function oncentercutout(index, sideindex) {
    centercutout(index, sideindex);
    onsetshapesidecutout(0, 0, index, sideindex, shape.index);
}
function onresizecutout(index, sideindex) {
    let source = 'onresizecutout';
    var w = Math.round(parseFloat($('#shapectlinputwidth' + index).val()));
    var h = Math.round(parseFloat($('#shapectlinputheight' + index).val()));
    var side = shape.sides[sideindex];
    var cutout = side.cutouts[index];
    cutout.w = applymminchfact(w, 1, 2, source); cutout.h = applymminchfact(h, 1, 2, source);
    onsetshapesidecutout(0, 0, index, sideindex, shape.index);
    if (shape.mode == 'shape') { ActionCutout('onresizecutout'); }
}
function oncutoutholeschange(index, sideindex) {
    var side = shape.sides[sideindex];
    var cutout = side.cutouts[index];
    var holes = parseInt($('#shapectlinputholes' + index).val());
    cutout.holes = holes;
    onsetshapesidecutout(0, 0, index, sideindex, shape.index);
    if (shape.mode == 'shape') { ActionCutout('onresizecutout'); }
}
function ondeletecutout(index, sideindex) {
    removeshapetools();    
    deletecutout(index, sideindex);
    if (shape.mode == 'shape') { ActionCutout(index, 'ondeletecutout'); }   
}
function deletecutout(index, sideindex) {
    let side = shape.sides[sideindex];
    let cutout = side.cutouts[index];
    if (cutout != undefined) {
        cutout.Isactive = 0;
        let smode = shape.mode, sindex = shape.index;
        let cindex = sindex + "" + sideindex + "" + index;
        let cutoutg = cutoutsg.select("#" + smode + "cutoutg" + cindex);
        let cutoutmarkerg = cutoutsg.select("#" + smode + "cutoutmarkerg" + cindex);
        if (!cutoutg.empty()) { cutoutg.remove(); }
        if (!cutoutmarkerg.empty()) { cutoutmarkerg.remove(); }
        deletecutoutsink34(cutout.index, shape.areaid, shape.partsrno);
    }
}
function deletecutoutsink34(cutoursrno, areaid, partsrno) {
    let part = getpartbyareapartsrno(partsrno, areaid);
    if (part != undefined) {
        for (let j = 0; j < part.SinkList.length; j++) {
            let sink = part.SinkList[j];
            if (sink.CutoutSrno == cutoursrno && sink.PartSrNo == partsrno && sink.AreaID == areaid) {
                sink.Isactive = 0;
            }
        }
    }
}
function drawsidecutout(index, sideindex) {   
    let side = shape.sides[sideindex];    
    let cutout = side.cutouts[index], ctype = cutout.type;
    if (cutout != undefined) {
        if (cutout.dw == undefined) { setcutoutcoords(index, sideindex); }
        ctype = 'c73';
        if (ctype == 'cr' || ctype == 'cr1' || ctype == 'crf' || ctype == 'crd' || ctype == 'cor') { drawrectcutout32(index, sideindex); }
        else if (ctype == 'co' || ctype == 'co1' || ctype == 'co2') { drawovalcutout(index, sideindex); }
        else if (ctype == 'rc') { drawrangecutout(index, sideindex); } else { drawdoublerectcutout32(index, sideindex); }
        rotatecutout(index, sideindex);
        if (shape.mode != 'slabpart') {
            if (cutout.dw != 0) { drawcutoutmarkers(index, sideindex); }
        }
    }   
}
function drawsidecutouts(index) {
    let side = shape.sides[index];
    if (side != undefined) {
        for (let j = 0; j < side.cutouts.length; j++) {
            if (side.cutouts[j].Isactive == 1) {
                drawsidecutout32(j, index);
            }
        }
    }
}
function drawsidecutout32(index, sideindex) {
    let side = shape.sides[sideindex];
    let cutout = side.cutouts[index], ctype = cutout.type;    
    if (cutout.cutoutshape == undefined) { cutout.x += cutout.w / 2, cutout.y += cutout.h / 2, cutout.cutoutshape = ""; }//add vflag
    //console.log(index, sideindex, ctype, JSON.stringify(cutout));
    if (cutout != undefined) {
        if (cutout.dw == undefined) { setcutoutcoords(index, sideindex); }        
        if (ctype == 'rect0' || ctype == 'sbrtm' || ctype == 'sbrum' || ctype == 'sbrbt' || ctype == 'vttm' || ctype == 'vtum' || ctype == 'vtsr' || ctype == 'cr' || ctype == 'cr1' || ctype == 'crf' || ctype == 'crd' || ctype == 'cor') {
            drawrectcutout32(index, sideindex); }
        else if (ctype == 'otm' || ctype == 'oum' || ctype == 'bttm' || ctype == 'btum' || ctype == 'co' || ctype == 'co1' || ctype == 'co2') { drawovalcutout32(index, sideindex); }
        else if (ctype == 'ckt4b' || ctype == 'ckt5b' || ctype == 'rc') { drawrangecutout32(index, sideindex); } 
        else if (ctype == 'outlet0' || ctype == 'outlet1' || ctype == 'outlet2' || ctype == 'outlet3') { drawoutletcutout32(index, sideindex); }
        else if (ctype == 'niche') { drawnichecutout32(index, sideindex); }
        else { drawdoublerectcutout32(index, sideindex); }        
        if (shape.mode != 'slabpart') {
            drawcutoutmarkers(index, sideindex);
        }
        rotatecutout(index, sideindex);
    }
}
function drawrectcutout32(index, sideindex) {
    let sindex = shape.index, smode = shape.mode, partsrno = shape.partsrno, areaid = shape.areaid, spindex = shape.spindex;
    let side = shape.sides[sideindex];
    let cutout = side.cutouts[index];
    let x = cutout.x, y = cutout.y, w = cutout.w, h = cutout.h, holes = cutout.holes, type = cutout.type, cshape = cutout.cutoutshape, cpath = '';
    let ix = 0, iy = 0, iw = 0, ih = 0, ox = 0, oy = 0, ow = 0, oh = 0, cx = 0, cy = 0, r = 8, cr = 5, cdx = 14, tl = 1, tr = 1, bl = 1, br = 1;
    ow = w, oh = h, ox = x - ow / 2, oy = y - oh / 2;
    if (type == 'rect0') { r = 0; }
    if (type == 'sbrtm' || type == 'vttm' || type == 'vtsr') { iw = w - 10, ih = h - 20, ix = x - iw / 2, iy = y - (ih / 2) + 5; } else { iw = w, ih = h, ix = x - iw / 2, iy = y - ih / 2; }
    if (type == 'sbrbt') { oh += 10; bl = 0, br = 0; }
    let cindex = sideindex + "" + index;
    let cutoutg = initcutoutg(index, sideindex);
    let corectouter = cutoutg.select("#corectouter" + cindex);
    if (type == 'sbrtm' || type == 'sbrbt' || type == 'vttm' || type == 'vtsr') {
        if (corectouter.empty()) {
            corectouter = cutoutg.append("path").attr("id", "corectouter" + cindex).attr("index", index).attr("sideindex", sideindex).attr("sindex", sindex)
                    .attr("spindex", spindex).attr("partsrno", partsrno).attr("areaid", areaid).attr("smode", smode);
        }        
        cpath = rounded_rect(ox, oy, ow, oh, r, tl, tr, bl, br);
        corectouter.attr("d", cpath).attr("class", "cutoutinner");
    }
    let corectinner = cutoutg.select("#corectinner" + cindex);
    if (corectinner.empty()) {
        corectinner = cutoutg.append("path").attr("id", "corectinner" + cindex).attr("index", index).attr("sideindex", sideindex).attr("sindex", sindex)
            .attr("spindex", spindex).attr("partsrno", partsrno).attr("areaid", areaid).attr("smode", smode);
    }
    cpath = rounded_rect(ix, iy, iw, ih, r, tl, tr, bl, br);
    corectinner.attr("d", cpath).attr("class", "cutoutinner");
    cx = (ix + iw / 2), cy = iy + 10;

    if (type != 'rect0') {
        let corectcircle = cutoutg.select("#corectcircle" + cindex);
        if (corectcircle.empty()) {
            corectcircle = cutoutg.append("circle").attr("id", "corectcircle" + cindex).attr("index", index).attr("sideindex", sideindex).attr("sindex", sindex).attr("spindex", spindex)
                .attr("partsrno", partsrno).attr("areaid", areaid).attr("smode", smode);
        }
        corectcircle.attr("cx", cx).attr("cy", cy).attr("r", cr).attr("class", "cutoutinner");
    }
    cx = (ox + ow / 2) - (6 * (holes - 1)), cy = oy - 10;
    for (let i = 0; i < holes; i++) {
        corectcircle = cutoutg.select("#corectcircle" + cindex + + "" + i);
        if (corectcircle.empty()) {
            corectcircle = cutoutg.append("circle").attr("id", "corectcircle" + cindex + + "" + i).attr("index", index).attr("sideindex", sideindex).attr("sindex", sindex).attr("spindex", spindex)
                .attr("partsrno", partsrno).attr("areaid", areaid).attr("smode", smode);
        }
        corectcircle.attr("cx", cx).attr("cy", cy).attr("r", cr).attr("class", "cutoutinner");
        cx += cdx;
    }    
    if (shape.mode == 'shape') {
        corectinner.on("mouseover", showcutoutmarkers).on("mouseout", hidecutoutmarkers).on("contextmenu", oncutoutcontextmenu);
        if (!corectouter.empty()) { corectouter.on("mouseover", showcutoutmarkers).on("mouseout", hidecutoutmarkers).on("contextmenu", oncutoutcontextmenu); }
    }
}
function drawdoublerectcutout32(index, sideindex) {
    let sindex = shape.index, smode = shape.mode, partsrno = shape.partsrno, areaid = shape.areaid, spindex = shape.spindex;
    let side = shape.sides[sideindex];
    let cutout = side.cutouts[index];
    let x = cutout.x, y = cutout.y, w = cutout.w, h = cutout.h, holes = cutout.holes, type = cutout.type, cshape = cutout.cutoutshape, cpath = '';
    let ix = 0, iy = 0, iw = 0, ih = 0, ox = 0, oy = 0, ow = 0, oh = 0, lw = 0, lh = 0, irwidth = 0, cx = 0, cy = 0, r = 8, cr = 5, cdx = 14, tl = 1, tr = 1, bl = 1, br = 1, m = 4;
   
    ow = w, oh = h, ox = x - ow / 2, oy = y - oh / 2;
    if (type == 'dbrtm30' || type == 'dbrtm40' || type == 'dbrtm50' || type == 'dbrtm60' || type == 'dbrtm70') { iw = w - 10, ih = h - 20, lh = h - 20, ix = x - iw / 2, iy = y - (ih / 2) + 5; }
    else { iw = w, ih = h, lh = h, ix = x - (iw / 2), iy = y - (ih / 2); }
    if (type == 'dbrbt30' || type == 'dbrbt40' || type == 'dbrbt50' || type == 'dbrbt60' || type == 'dbrbt70') { oh += 10; bl = 0, br = 0; }
    irwidth = (iw - 2 * m), lw = rw = irwidth * 0.5;
    if (type == 'dbrtm30' || type == 'dbrbt30' || type == 'dbrum30') {
        lw = irwidth * 0.3, rw = irwidth * 0.7;
    } else if (type == 'dbrtm40' || type == 'dbrbt40' || type == 'dbrum40') {
        lw = irwidth * 0.4, rw = irwidth * 0.6;
    } else if (type == 'dbrtm50' || type == 'dbrbt50' || type == 'dbrum50') {
        lw = rw = irwidth * 0.5;
    } else if (type == 'dbrtm60' || type == 'dbrbt60' || type == 'dbrum60') {
        lw = irwidth * 0.6, rw = irwidth * 0.4;
    } else if (type == 'dbrtm70' || type == 'dbrbt70' || type == 'dbrum70') {
        lw = irwidth * 0.7, rw = irwidth * 0.3;
    }

    let cindex = sideindex + "" + index;
    let cutoutg = initcutoutg(index, sideindex);
    let corectouter = cutoutg.select("#corectouter" + cindex);
    if (type == 'dbrtm30' || type == 'dbrtm40' || type == 'dbrtm50' || type == 'dbrtm60' || type == 'dbrtm70' || type == 'dbrbt30' || type == 'dbrbt40' || type == 'dbrbt50' || type == 'dbrbt60' || type == 'dbrbt70') {
        if (corectouter.empty()) {
            corectouter = cutoutg.append("path").attr("id", "corectouter" + cindex).attr("index", index).attr("sideindex", sideindex).attr("sindex", sindex)
                .attr("spindex", spindex).attr("partsrno", partsrno).attr("areaid", areaid).attr("smode", smode);
        }
        cpath = rounded_rect(ox, oy, ow, oh, r, tl, tr, bl, br);
        corectouter.attr("d", cpath).attr("class", "cutoutinner");
    }
    let corectlinner = cutoutg.select("#corectlinner" + cindex);
    let corectrinner = cutoutg.select("#corectrinner" + cindex);
    if (corectlinner.empty()) {
        corectlinner = cutoutg.append("path").attr("id", "corectlinner" + cindex).attr("index", index).attr("sideindex", sideindex).attr("sindex", sindex).attr("spindex", spindex)
            .attr("partsrno", partsrno).attr("areaid", areaid).attr("smode", smode);
    }
    if (corectrinner.empty()) {
        corectrinner = cutoutg.append("path").attr("id", "corectrinner" + cindex).attr("index", index).attr("sideindex", sideindex).attr("sindex", sindex).attr("spindex", spindex)
            .attr("partsrno", partsrno).attr("areaid", areaid).attr("smode", smode);
    }
    cpath = rounded_rect(ix, iy, lw, lh, r, tl, tr, bl, br);
    corectlinner.attr("d", cpath).attr("class", "cutoutinner");
    cpath = rounded_rect(ix + lw + 2 * m, iy, rw, lh, r, tl, tr, bl, br);
    corectrinner.attr("d", cpath).attr("class", "cutoutinner");

    cx = (ix + lw / 2), cy = iy + 10;
    let corectcircle = cutoutg.select("#corectcircle" + cindex + + "" + "l");
    if (corectcircle.empty()) {
        corectcircle = cutoutg.append("circle").attr("id", "corectcircle" + cindex + + "" + "l").attr("index", index)
            .attr("sindex", sindex).attr("spindex", spindex).attr("partsrno", partsrno).attr("areaid", areaid).attr("smode", smode);
    }
    corectcircle.attr("cx", cx).attr("cy", cy).attr("r", cr).attr("class", "cutoutinner");

    cx = (ix + lw + (2 * m) + (rw / 2)), cy = iy + 10;
    corectcircle = cutoutg.select("#corectcircle" + cindex + + "" + "r");
    if (corectcircle.empty()) {
        corectcircle = cutoutg.append("circle").attr("id", "corectcircle" + cindex + + "" + "l").attr("index", index)
            .attr("sindex", sindex).attr("spindex", spindex).attr("partsrno", partsrno).attr("areaid", areaid).attr("smode", smode);
    }
    corectcircle.attr("cx", cx).attr("cy", cy).attr("r", cr).attr("class", "cutoutinner");
    cx = (ox + w / 2) - (6 * (holes - 1));
    cdx = 14, rx = 6, ry = 6; cy = oy; rcy = oy - 10;
    for (let i = 0; i < holes; i++) {
        corectcircle = cutoutg.select("#corectcircle" + cindex + + "" + i);
        if (corectcircle.empty()) {
            corectcircle = cutoutg.append("circle").attr("id", "corectcircle" + cindex + + "" + i).attr("index", index)
                .attr("sindex", sindex).attr("spindex", spindex).attr("partsrno", partsrno).attr("areaid", areaid).attr("smode", smode);
        }
        corectcircle.attr("cx", cx).attr("cy", rcy).attr("r", cr).attr("class", "cutoutinner");
        cx += cdx;
    }
    if (shape.mode == 'shape') {
        corectlinner.on("mouseover", showcutoutmarkers).on("mouseout", hidecutoutmarkers).on("contextmenu", oncutoutcontextmenu);
        corectrinner.on("mouseover", showcutoutmarkers).on("mouseout", hidecutoutmarkers).on("contextmenu", oncutoutcontextmenu);
        if (!corectouter.empty()) { corectouter.on("mouseover", showcutoutmarkers).on("mouseout", hidecutoutmarkers).on("contextmenu", oncutoutcontextmenu); }
    }
}
function drawovalcutout32(index, sideindex) {
    let sindex = shape.index, smode = shape.mode, partsrno = shape.partsrno, areaid = shape.areaid, spindex = shape.spindex;
    let side = shape.sides[sideindex];
    let cutout = side.cutouts[index];
    let x = cutout.x, y = cutout.y, w = cutout.w, h = cutout.h, holes = cutout.holes, type = cutout.type, cshape = cutout.cutoutshape;
    let ow = 0, oh = 0, ox = 0, oy = 0, iw = 0, ih = 0, ix = 0, iy = 0, pcrh = -9, pcrw = 7, pcrx = 14, cr = 5;
    ow = w / 2; oh = h / 2, ox = x, oy = y;
    if (type == 'otm' || type == 'bttm') { iw = ow - 10; ih = oh - 10, ix = ox, iy = oy + 6; } else { iw = ow; ih = oh, ix = ox, iy = oy; }
    
    let cindex = sideindex + "" + index;
    let cutoutg = initcutoutg(index, sideindex);
    let coovalouter = cutoutg.select("#coovalouter" + cindex);
    if (type == 'otm' || type == 'bttm') {
        if (coovalouter.empty()) {
            coovalouter = cutoutg.append("ellipse").attr("id", "coovalouter" + cindex).attr("index", index).attr("sideindex", sideindex)
                .attr("sindex", sindex).attr("spindex", spindex).attr("partsrno", partsrno).attr("areaid", areaid).attr("smode", smode);
        }
        coovalouter.attr("cx", ox).attr("cy", oy).attr("rx", ow).attr("ry", oh).attr("class", "cutoutinner");
    }
    let coovalinner = cutoutg.select("#coovalinner" + cindex);
    if (coovalinner.empty()) {
        coovalinner = cutoutg.append("ellipse").attr("id", "coovalinner" + cindex).attr("index", index).attr("sideindex", sideindex)
            .attr("sindex", sindex).attr("spindex", spindex).attr("partsrno", partsrno).attr("areaid", areaid).attr("smode", smode);
    }
    coovalinner.attr("cx", ix).attr("cy", iy).attr("rx", iw).attr("ry", ih).attr("class", "cutoutinner");

    let crcx = ix, crcy = iy + pcrh;
    let coovalcircle = cutoutg.select("#coovalcircle" + cindex);
    if (coovalcircle.empty()) {
        coovalcircle = cutoutg.append("circle").attr("id", "coovalcircle" + cindex).attr("index", index).attr("sideindex", sideindex)
            .attr("sindex", sindex).attr("spindex", spindex).attr("partsrno", partsrno).attr("areaid", areaid).attr("smode", smode);
    }
    coovalcircle.attr("cx", crcx).attr("cy", crcy).attr("r", cr).attr("class", "cutoutinner");
   
    crcx = (ox) - (pcrw * (holes - 1)), crcy = oy - oh + pcrh;
    for (let i = 0; i < holes; i++) {
        coovalcircle = cutoutg.select("#coovalcircle" + cindex + "" + i);
        if (coovalcircle.empty()) {
            coovalcircle = cutoutg.append("circle").attr("id", "coovalcircle" + cindex + "" + i).attr("index", index).attr("sideindex", sideindex)
                .attr("sindex", sindex).attr("spindex", spindex).attr("partsrno", partsrno).attr("areaid", areaid).attr("smode", smode);
        }
        coovalcircle.attr("cx", crcx).attr("cy", crcy).attr("r", cr).attr("class", "cutoutinner");
        crcx += pcrx;
    }    
    if (shape.mode == 'shape') {
        coovalinner.on("mouseover", showcutoutmarkers).on("mouseout", hidecutoutmarkers).on("contextmenu", oncutoutcontextmenu);
        if (!coovalouter.empty()) { coovalouter.on("mouseover", showcutoutmarkers).on("mouseout", hidecutoutmarkers).on("contextmenu", oncutoutcontextmenu); }
    }   
}
function drawrangecutout32(index, sideindex) {
    let sindex = shape.index, smode = shape.mode, partsrno = shape.partsrno, areaid = shape.areaid, spindex = shape.spindex;
    let side = shape.sides[sideindex];
    let cutout = side.cutouts[index];
    let x = cutout.x, y = cutout.y, w = cutout.w, h = cutout.h, holes = cutout.holes, type = cutout.type, cshape = cutout.cutoutshape;
    
    x = x - w / 2, y = y - h / 2;
    let cindex = sideindex + "" + index;
    let cutoutg = initcutoutg(index, sideindex);
    let cotloutcircle = cutoutg.select("#cotloutcircle" + cindex);    
    let cotroutcircle = cutoutg.select("#cotroutcircle" + cindex);
    let cobloutcircle = cutoutg.select("#cobloutcircle" + cindex);
    let cobroutcircle = cutoutg.select("#cobroutcircle" + cindex);
    let cotlincircle = cutoutg.select("#cotlincircle" + cindex);
    let cotrincircle = cutoutg.select("#cotrincircle" + cindex);
    let coblincircle = cutoutg.select("#coblincircle" + cindex);
    let cobrincircle = cutoutg.select("#cobrincircle" + cindex);
    let corectouter = cutoutg.select("#corectouter" + cindex);

    if (cotloutcircle.empty()) { cotloutcircle = cutoutg.append("circle").attr("id", "cotloutcircle" + cindex); }
    if (cotroutcircle.empty()) { cotroutcircle = cutoutg.append("circle").attr("id", "cotroutcircle" + cindex); }    
    if (cobloutcircle.empty()) { cobloutcircle = cutoutg.append("circle").attr("id", "cobloutcircle" + cindex); }
    if (cobroutcircle.empty()) { cobroutcircle = cutoutg.append("circle").attr("id", "cobroutcircle" + cindex); }
    if (cotlincircle.empty()) { cotlincircle = cutoutg.append("circle").attr("id", "cotlincircle" + cindex); }
    if (cotrincircle.empty()) { cotrincircle = cutoutg.append("circle").attr("id", "cotrincircle" + cindex); }
    if (coblincircle.empty()) { coblincircle = cutoutg.append("circle").attr("id", "coblincircle" + cindex); }
    if (cobrincircle.empty()) { cobrincircle = cutoutg.append("circle").attr("id", "cobrincircle" + cindex); }
    let dw = cutout.w / 4, dh = cutout.h / 4, dw2 = cutout.w / 2, outr = 10, inr = 5, irdx = 6, irdy = 8;
    //if (shape.mode == 'part') { outr = outr / pswidthratio; inr = inr / pswidthratio; irdx = irdx / pswidthratio; }
    //else if (shape.mode == 'print') { outr = outr / prswidthratio; inr = inr / prswidthratio; irdx = irdx / prswidthratio; }
    cotloutcircle.attr("cx", x + dw).attr("cy", y + dh).attr("r", outr).attr("class", "cutoutinner");    
    cotroutcircle.attr("cx", x + 3 * dw).attr("cy", y + dh).attr("r", outr).attr("class", "cutoutinner");
    cobloutcircle.attr("cx", x + dw).attr("cy", y + 3 * dh).attr("r", outr).attr("class", "cutoutinner");
    cobroutcircle.attr("cx", x + 3 * dw).attr("cy", y + 3 * dh).attr("r", outr).attr("class", "cutoutinner");
    cotlincircle.attr("cx", x + dw2 - irdx).attr("cy", y + 3* dh - irdx).attr("r", inr).attr("class", "cutoutinner");
    cotrincircle.attr("cx", x + dw2 + irdx).attr("cy", y + 3* dh - irdx).attr("r", inr).attr("class", "cutoutinner");
    coblincircle.attr("cx", x + dw2 - irdx).attr("cy", y + 3* dh + irdx).attr("r", inr).attr("class", "cutoutinner");
    cobrincircle.attr("cx", x + dw2 + irdx).attr("cy", y + 3* dh + irdx).attr("r", inr).attr("class", "cutoutinner");
    if (type == 'ckt5b') {
        let cotmoutcircle = cutoutg.select("#cotmoutcircle" + cindex);
        if (cotmoutcircle.empty()) { cotmoutcircle = cutoutg.append("circle").attr("id", "cotmoutcircle" + cindex); }
        cotmoutcircle.attr("cx", x + 2 * dw).attr("cy", y + dh).attr("r", outr).attr("class", "cutoutinner");
    }
    if (corectouter.empty()) {
        corectouter = cutoutg.append("rect").attr("id", "corectouter" + cindex).attr("index", index).attr("sideindex", sideindex)
            .attr("sindex", sindex).attr("spindex", spindex).attr("partsrno", partsrno).attr("areaid", areaid).attr("smode", smode);
    }
    corectouter.attr("x", x).attr("y", y).attr("rx", 10).attr("ry", 10).attr("width", cutout.w).attr("height", cutout.h).attr("class", "cutoutouter");
    if (shape.mode == 'shape') {
        corectouter.on("mouseover", showcutoutmarkers).on("mouseout", hidecutoutmarkers).on("contextmenu", oncutoutcontextmenu);
    }
    //if (shape.mode == 'part') { corectouter.on("click", onshape); }
}
function drawoutletcutout32(index, sideindex) {
    let sindex = shape.index, smode = shape.mode, partsrno = shape.partsrno, areaid = shape.areaid, spindex = shape.spindex;
    let side = shape.sides[sideindex];
    let cutout = side.cutouts[index];
    let x = cutout.x, y = cutout.y, w = cutout.w, h = cutout.h, holes = cutout.holes, type = cutout.type, cshape = cutout.cutoutshape;
    x = x - w / 2, y = y - h / 2;

    let cindex = sideindex + "" + index;
    let cutoutg = initcutoutg(index, sideindex);
    let corectouter = cutoutg.select("#corectouter" + cindex);
    if (corectouter.empty()) {
        corectouter = cutoutg.append("rect").attr("id", "corectouter" + cindex).attr("index", index).attr("sideindex", sideindex)
            .attr("sindex", sindex).attr("spindex", spindex).attr("partsrno", partsrno).attr("areaid", areaid).attr("smode", smode);
    }
    let rx = 10, ry = 10; if (type == 'outlet0') { rx = 0; ry = 0; }
    corectouter.attr("x", x).attr("y", y).attr("rx", rx).attr("ry", ry).attr("width", cutout.w).attr("height", cutout.h).attr("class", "cutoutouter");

    let dx1 = 0, dx2 = 0, dx3 = 0, dy1 = 0, dy2 = 0, dy3 = 0, dw = w / 4, dh = h / 4, outw = 10, outh = 10, dw1 = 10, dh1 = 8;

    if (type == 'outlet0') { dx1 = x + 2 * dw, dy1 = y + 2 * dh, holes = 0; }
    else if (type == 'outlet1') { dx1 = x + 2 * dw, dy1 = y + 2 * dh, holes = 1; }
    else if (type == 'outlet2') { dx1 = x + 2 * dw, dy1 = y + dh, dx2 = x + 2 * dw, dy2 = y + 3 * dh, holes = 2; }
    else if (type == 'outlet3') { dx1 = x + dw, dy1 = y + 2 * dh, dx2 = x + 2 * dw, dy2 = y + 2 * dh, dx3 = x + 3 * dw, dy3 = y + 2 * dh, holes = 3; }

    cindex += "" + 1;
    if (type != 'outlet0') {
        let cotloutrect = cutoutg.select("#cotloutrect" + cindex);
        if (cotloutrect.empty()) { cotloutrect = cutoutg.append("rect").attr("id", "cotloutrect" + cindex); }
        cotloutrect.attr("x", dx1 - dw1).attr("y", dy1 - dh1).attr("width", outw).attr("height", outh).attr("class", "cutoutinner");
        let cotroutrect = cutoutg.select("#cotroutrect" + cindex);
        if (cotroutrect.empty()) { cotroutrect = cutoutg.append("rect").attr("id", "cotroutrect" + cindex); }
        cotroutrect.attr("x", dx1 + dw1).attr("y", dy1 - dh1).attr("width", outw).attr("height", outh).attr("class", "cutoutinner");
        let cotmoutrect = cutoutg.select("#cotmoutrect" + cindex);
        if (cotmoutrect.empty()) { cotmoutrect = cutoutg.append("rect").attr("id", "cotloutrect" + cindex); }
        cotmoutrect.attr("x", dx1).attr("y", dy1 + dh1).attr("width", outw).attr("height", outh).attr("class", "cutoutinner");
    }
    if (holes > 1) {
        cindex += "" + 2;
        let cotloutrect = cutoutg.select("#cotloutrect" + cindex);
        if (cotloutrect.empty()) { cotloutrect = cutoutg.append("rect").attr("id", "cotloutrect" + cindex); }
        cotloutrect.attr("x", dx2 - dw1).attr("y", dy2 - dh1).attr("width", outw).attr("height", outh).attr("class", "cutoutinner");
        let cotroutrect = cutoutg.select("#cotroutrect" + cindex);
        if (cotroutrect.empty()) { cotroutrect = cutoutg.append("rect").attr("id", "cotroutrect" + cindex); }
        cotroutrect.attr("x", dx2 + dw1).attr("y", dy2 - dh1).attr("width", outw).attr("height", outh).attr("class", "cutoutinner");
        let cotmoutrect = cutoutg.select("#cotmoutrect" + cindex);
        if (cotmoutrect.empty()) { cotmoutrect = cutoutg.append("rect").attr("id", "cotloutrect" + cindex); }
        cotmoutrect.attr("x", dx2).attr("y", dy2 + dh1).attr("width", outw).attr("height", outh).attr("class", "cutoutinner");
    }
    if (holes > 2) {
        cindex += "" + 3;
        let cotloutrect = cutoutg.select("#cotloutrect" + cindex);
        if (cotloutrect.empty()) { cotloutrect = cutoutg.append("rect").attr("id", "cotloutrect" + cindex); }
        cotloutrect.attr("x", dx3 - dw1).attr("y", dy3 - dh1).attr("width", outw).attr("height", outh).attr("class", "cutoutinner");
        let cotroutrect = cutoutg.select("#cotroutrect" + cindex);
        if (cotroutrect.empty()) { cotroutrect = cutoutg.append("rect").attr("id", "cotroutrect" + cindex); }
        cotroutrect.attr("x", dx3 + dw1).attr("y", dy3 - dh1).attr("width", outw).attr("height", outh).attr("class", "cutoutinner");
        let cotmoutrect = cutoutg.select("#cotmoutrect" + cindex);
        if (cotmoutrect.empty()) { cotmoutrect = cutoutg.append("rect").attr("id", "cotloutrect" + cindex); }
        cotmoutrect.attr("x", dx3).attr("y", dy3 + dh1).attr("width", outw).attr("height", outh).attr("class", "cutoutinner");
    }
    if (shape.mode == 'shape') {
        corectouter.on("mouseover", showcutoutmarkers).on("mouseout", hidecutoutmarkers).on("contextmenu", oncutoutcontextmenu);
    }
}
function drawnichecutout32(index, sideindex) {
    let sindex = shape.index, smode = shape.mode, partsrno = shape.partsrno, areaid = shape.areaid, spindex = shape.spindex;
    let side = shape.sides[sideindex];
    let cutout = side.cutouts[index];
    let x = cutout.x, y = cutout.y, w = cutout.w, h = cutout.h, holes = cutout.holes, type = cutout.type, cshape = cutout.cutoutshape;
    x = x - w / 2, y = y - h / 2;
   
    let cindex = sideindex + "" + index;
    let cutoutg = initcutoutg(index, sideindex);
    let corectouter = cutoutg.select("#corectouter" + cindex);
    if (corectouter.empty()) {
        corectouter = cutoutg.append("path").attr("id", "corectouter" + cindex).attr("index", index).attr("sideindex", sideindex)
            .attr("sindex", sindex).attr("spindex", spindex).attr("partsrno", partsrno).attr("areaid", areaid).attr("smode", smode);
    }    
    
    let angle = calclineangle2(side.x11, side.y11, side.x12, side.y12, 'drawnichecutout32');
    let npt = rotate_point1(x, y, -1, angle, w);
    let x1 = x, y1 = y, x2 = x1 + w, y2 = y, x3 = (x1 + x2) / 2, y3 = y1 - h;

    let copath = "M " + x1 + " " + y1 + " Q " + x3 + " " + y3 + " " + x2 + " " + y2 + " v " + h + " h " + -w + "z";

    corectouter.attr("d", copath).attr("class", "cutoutouter");

    if (shape.mode == 'shape') {
        corectouter.on("mouseover", showcutoutmarkers).on("mouseout", hidecutoutmarkers).on("contextmenu", oncutoutcontextmenu);
    }
}
function drawrectcutout(index, sideindex) {
    let sindex = shape.index, smode = shape.mode, partsrno = shape.partsrno, areaid = shape.areaid, spindex = shape.spindex;
    let side = shape.sides[sideindex];
    let cutout = side.cutouts[index];   
    let x = cutout.x, y = cutout.y, w = cutout.w, h = cutout.h, holes = cutout.holes, type = cutout.type;
    let ix = 0, iy = 0, iw = 0, ih = 0, ox = 0, oy = 0, ow = 0, oh = 0, cx = 0, cy = 0, rx = type == 'cor' ? 0 : 8, ry = type == 'cor' ? 0 : 8, cr = 5, cdx = 14;
  //  x = x - w / 2, y = y - h / 2;
    ix = x, iy = y, iw = w, ih = h;
    ox = x, oy = y, ow = w, oh = h;
    cx = (x + w / 2) - (6 * (holes - 1)), cy = y - 10;    
    let cindex = sideindex + "" + index;
    let cutoutg = initcutoutg(index, sideindex)
    let corectcircle;    
    let corectinner = cutoutg.select("#corectinner" + cindex);
    if (corectinner.empty()) {
        corectinner = cutoutg.append("rect").attr("id", "corectinner" + cindex).attr("index", index).attr("sideindex", sideindex).attr("sindex", sindex)
            .attr("spindex", spindex).attr("partsrno", partsrno).attr("areaid", areaid).attr("smode", smode);
    }
    for (let i = 0; i < holes; i++) {
        corectcircle = cutoutg.select("#corectcircle" + cindex + + "" + i);
        if (corectcircle.empty()) {
            corectcircle = cutoutg.append("circle").attr("id", "corectcircle" + cindex + + "" + i).attr("index", index).attr("sideindex", sideindex).attr("sindex", sindex).attr("spindex", spindex)
                .attr("partsrno", partsrno).attr("areaid", areaid).attr("smode", smode);
        }
        corectcircle.attr("cx", cx).attr("cy", cy).attr("r", cr).attr("class", "cutoutinner");
        cx += cdx;
    }
    corectinner.attr("x", ix).attr("y", iy).attr("rx", rx).attr("ry", ry).attr("width", iw).attr("height", ih).attr("class", "cutoutinner");
    if (type == 'crf' || type == 'crd') {
        let mtext = ''; if (type == 'crf') { mtext = 'FARM' } else if (type == 'crd') { mtext = 'DROP' }
        let ctx = x + w / 2 - 16, cty = y + 15;
        let cotext = cutoutg.select("#cotext" + cindex);
        if (cotext.empty()) { cotext = cutoutg.append("text").attr("id", "cotext" + cindex); }
        cotext.attr("x", ctx).attr("y", cty).text(mtext);
    }
    if (shape.mode == 'shape') {
        corectinner.on("mouseover", showcutoutmarkers).on("mouseout", hidecutoutmarkers).on("contextmenu", oncutoutcontextmenu);
    }
    //if (shape.mode == 'part') { corectinner.on("click", onshape); }
}
function drawdoublecutout(index, sideindex) {
    let sindex = shape.index, smode = shape.mode, partsrno = shape.partsrno, areaid = shape.areaid, spindex = shape.spindex;
    let side = shape.sides[sideindex];
    let cutout = side.cutouts[index];
    let x = cutout.x, y = cutout.y, w = cutout.w, h = cutout.h, holes = cutout.holes, type = cutout.type;
  //  x = x - w / 2, y = y - h / 2;
    var m = 4, cr = 5, irwidth = (w - 3 * m), lw = rw = irwidth * 0.5, lh = h;
    if (type == "cd") { lw = rw = irwidth * 0.5; } else if (type == "c64") { lw = irwidth * 0.6, rw = irwidth * 0.4 }
    else if (type == "c46") { lw = irwidth * 0.4, rw = irwidth * 0.6 } else if (type == "c73") { lw = irwidth * 0.7, rw = irwidth * 0.3 }
    else if (type == "c37") { lw = irwidth * 0.3, rw = irwidth * 0.7 }
    var cindex = sideindex + "" + index;
    var cutoutg = initcutoutg(index, sideindex);
    var corectlinner = cutoutg.select("#corectlinner" + cindex);
    var corectrinner = cutoutg.select("#corectrinner" + cindex);
    if (corectlinner.empty()) {
        corectlinner = cutoutg.append("rect").attr("id", "corectlinner" + cindex).attr("index", index).attr("sideindex", sideindex)
            .attr("sindex", sindex).attr("spindex", spindex).attr("partsrno", partsrno).attr("areaid", areaid).attr("smode", smode);
    }
    if (corectrinner.empty()) {
        corectrinner = cutoutg.append("rect").attr("id", "corectrinner" + cindex).attr("index", index).attr("sideindex", sideindex)
            .attr("sindex", sindex).attr("spindex", spindex).attr("partsrno", partsrno).attr("areaid", areaid).attr("smode", smode);
    }
    var corectcircle;
    var cx = (x + w / 2) - (6 * (holes - 1));
    var cdx = 14, rx = 6, ry = 6; cy = y; rcy = y - 10;
    //if (shape.mode == 'print') {
    //    lh = h; cr = 2.5; rx = 5; ry = 5; cy = y; rcy = y - 5;
    //    cx = (x + w / 2) - (2 * (holes - 1)); cdx = 8;
    //}
    for (var i = 0; i < holes; i++) {
        corectcircle = cutoutg.select("#corectcircle" + cindex + + "" + i);
        if (corectcircle.empty()) {
            corectcircle = cutoutg.append("circle").attr("id", "corectcircle" + cindex + + "" + i).attr("index", index)
                .attr("sindex", sindex).attr("spindex", spindex).attr("partsrno", partsrno).attr("areaid", areaid).attr("smode", smode);
        }
        corectcircle.attr("cx", cx).attr("cy", rcy).attr("r", cr).attr("class", "cutoutinner");
        cx += cdx;
    }
    corectlinner.attr("x", x + m).attr("y", cy).attr("rx", rx).attr("ry", ry).attr("width", lw).attr("height", lh).attr("class", "cutoutinner");
    corectrinner.attr("x", x + lw + 2 * m).attr("y", cy).attr("rx", ry).attr("ry", ry).attr("width", rw).attr("height", lh).attr("class", "cutoutinner");
    // corectouter.attr("x", cutout.x).attr("y", cutout.y).attr("rx", 10).attr("ry", 10).attr("width", cutout.w).attr("height", cutout.h).attr("class", "cutoutouter");
    if (shape.mode == 'shape') {
        corectlinner.on("mouseover", showcutoutmarkers).on("mouseout", hidecutoutmarkers).on("contextmenu", oncutoutcontextmenu);
        corectrinner.on("mouseover", showcutoutmarkers).on("mouseout", hidecutoutmarkers).on("contextmenu", oncutoutcontextmenu);
    }
    //if (shape.mode == 'part') { corectrinner.on("click", onshape); }
}
function drawovalcutout(index, sideindex) {
    let sindex = shape.index, smode = shape.mode, partsrno = shape.partsrno, areaid = shape.areaid, spindex = shape.spindex;
    let side = shape.sides[sideindex];
    let cutout = side.cutouts[index];
    var x = cutout.x, y = cutout.y, w = cutout.w, h = cutout.h, holes = cutout.holes, type = cutout.type;
    //x = x - w / 2, y = y - h / 2;
    var cw = w / 2; ch = h / 2, cx = x + cw, cy = y + ch;
    var pcrh = -9, pcrw = 7, pcrx = 14, cr = 5;
    //if (shape.mode == 'print') {
    //    cr = 2.5; pcry = h + 3; pcrx = 7; pcrw = 3; //cutout.rx = cutout.w / 2; cutout.ry = cutout.h / 2;
    //}
    var cindex = sideindex + "" + index;
    var cutoutg = initcutoutg(index, sideindex);
    var coovalouter = cutoutg.select("#coovalouter" + cindex);
    if (coovalouter.empty()) {
        coovalouter = cutoutg.append("ellipse").attr("id", "coovalouter" + cindex).attr("index", index).attr("sideindex", sideindex)
            .attr("sindex", sindex).attr("spindex", spindex).attr("partsrno", partsrno).attr("areaid", areaid).attr("smode", smode);
    }
    var coovalcircle;
    var crcx = (cx) - (pcrw * (holes - 1)), crcy = y + pcrh;
    for (var i = 0; i < holes; i++) {
        coovalcircle = cutoutg.select("#coovalcircle" + cindex + "" + i);
        if (coovalcircle.empty()) {
            coovalcircle = cutoutg.append("circle").attr("id", "coovalcircle" + cindex + "" + i).attr("index", index).attr("sideindex", sideindex)
                .attr("sindex", sindex).attr("spindex", spindex).attr("partsrno", partsrno).attr("areaid", areaid).attr("smode", smode);
        }
        coovalcircle.attr("cx", crcx).attr("cy", crcy).attr("r", cr).attr("class", "cutoutinner");
        crcx += pcrx;
    }
    coovalouter.attr("cx", cx).attr("cy", cy).attr("rx", cw).attr("ry", ch).attr("class", "cutoutinner");
    if (shape.mode == 'shape') {
        coovalouter.on("mouseover", showcutoutmarkers).on("mouseout", hidecutoutmarkers).on("contextmenu", oncutoutcontextmenu);
    }
    // if (shape.mode == 'part') { coovalouter.on("click", onshape); }
}
function drawrangecutout(index, sideindex) {
    let sindex = shape.index, smode = shape.mode, partsrno = shape.partsrno, areaid = shape.areaid, spindex = shape.spindex;
    var side = shape.sides[sideindex];
    var cutout = side.cutouts[index];
    var x = cutout.x, y = cutout.y, w = cutout.w, h = cutout.h, holes = cutout.holes, type = cutout.type;
   // x = x - w / 2, y = y - h / 2;
    var cindex = sideindex + "" + index;
    var cutoutg = initcutoutg(index, sideindex);
    var cotloutcircle = cutoutg.select("#cotloutcircle" + cindex);
    var cotroutcircle = cutoutg.select("#cotroutcircle" + cindex);
    var cobloutcircle = cutoutg.select("#cobloutcircle" + cindex);
    var cobroutcircle = cutoutg.select("#cobroutcircle" + cindex);
    var cotlincircle = cutoutg.select("#cotlincircle" + cindex);
    var cotrincircle = cutoutg.select("#cotrincircle" + cindex);
    var coblincircle = cutoutg.select("#coblincircle" + cindex);
    var cobrincircle = cutoutg.select("#cobrincircle" + cindex);
    var corectouter = cutoutg.select("#corectouter" + cindex);

    if (cotloutcircle.empty()) { cotloutcircle = cutoutg.append("circle").attr("id", "cotloutcircle" + cindex); }
    if (cotroutcircle.empty()) { cotroutcircle = cutoutg.append("circle").attr("id", "cotroutcircle" + cindex); }
    if (cobloutcircle.empty()) { cobloutcircle = cutoutg.append("circle").attr("id", "cobloutcircle" + cindex); }
    if (cobroutcircle.empty()) { cobroutcircle = cutoutg.append("circle").attr("id", "cobroutcircle" + cindex); }
    if (cotlincircle.empty()) { cotlincircle = cutoutg.append("circle").attr("id", "cotlincircle" + cindex); }
    if (cotrincircle.empty()) { cotrincircle = cutoutg.append("circle").attr("id", "cotrincircle" + cindex); }
    if (coblincircle.empty()) { coblincircle = cutoutg.append("circle").attr("id", "coblincircle" + cindex); }
    if (cobrincircle.empty()) { cobrincircle = cutoutg.append("circle").attr("id", "cobrincircle" + cindex); }
    var dw = cutout.w / 4, dh = cutout.h / 4, dw2 = cutout.w / 2, outr = 10, inr = 5, irdx = 6;
    //if (shape.mode == 'part') { outr = outr / pswidthratio; inr = inr / pswidthratio; irdx = irdx / pswidthratio; }
    //else if (shape.mode == 'print') { outr = outr / prswidthratio; inr = inr / prswidthratio; irdx = irdx / prswidthratio; }
    cotloutcircle.attr("cx", x + dw).attr("cy", y + dh).attr("r", outr).attr("class", "cutoutinner");
    cotroutcircle.attr("cx", x + 3 * dw).attr("cy", y + dh).attr("r", outr).attr("class", "cutoutinner");
    cobloutcircle.attr("cx", x + dw).attr("cy", y + 3 * dh).attr("r", outr).attr("class", "cutoutinner");
    cobroutcircle.attr("cx", x + 3 * dw).attr("cy", y + 3 * dh).attr("r", outr).attr("class", "cutoutinner");
    cotlincircle.attr("cx", x + dw2 - irdx).attr("cy", y + dh - irdx).attr("r", inr).attr("class", "cutoutinner");
    cotrincircle.attr("cx", x + dw2 + irdx).attr("cy", y + dh - irdx).attr("r", inr).attr("class", "cutoutinner");
    coblincircle.attr("cx", x + dw2 - irdx).attr("cy", y + dh + irdx).attr("r", inr).attr("class", "cutoutinner");
    cobrincircle.attr("cx", x + dw2 + irdx).attr("cy", y + dh + irdx).attr("r", inr).attr("class", "cutoutinner");

    if (corectouter.empty()) {
        corectouter = cutoutg.append("rect").attr("id", "corectouter" + cindex).attr("index", index).attr("sideindex", sideindex)
            .attr("sindex", sindex).attr("spindex", spindex).attr("partsrno", partsrno).attr("areaid", areaid).attr("smode", smode);
    }
    corectouter.attr("x", x).attr("y", y).attr("rx", 10).attr("ry", 10).attr("width", cutout.w).attr("height", cutout.h).attr("class", "cutoutouter");
    if (shape.mode == 'shape') {
        corectouter.on("mouseover", showcutoutmarkers).on("mouseout", hidecutoutmarkers).on("contextmenu", oncutoutcontextmenu);
    }
    //if (shape.mode == 'part') { corectouter.on("click", onshape); }
}
function drawcutoutmarkers(index, sideindex) {  
    let source = 'drawcutoutmarkers';
    let side = shape.sides[sideindex];
    let cutout = side.cutouts[index], cx = cutout.x, cy = cutout.y, cw = cutout.w, ch = cutout.h, cdw = cutout.dw, cdh = cutout.dh, dh = 15, cshape = cutout.cutoutshape, cmtype = cutout.measuretype;
    let x1 = side.x1, y1 = side.y1, x2 = side.x2, y2 = side.y2;
    let x11 = side.x11, y11 = side.y11, x12 = side.x12, y12 = side.y12, w1 = applymminchfact(side.w1, 1, 2, source), h = applymminchfact1(side.h, 1, 2,source);
    let x21 = side.x21, y21 = side.y21, x22 = side.x22, y22 = side.y22, w2 = applymminchfact(side.w2, 1, 2, source);
    let cx1 = 0, cy1 = 0, cx2 = 0, cy2 = 0, cx3 = 0, cy3 = 0, angle = 0;
    if (cmtype == undefined) { cmtype = 1; }   
    if (cmtype == 3) {
        if (w1 >= w2) { cx1 = x22, cy1 = y22, cx2 = x21, cy2 = y21; } else { cx1 = x12, cy1 = y12, cx2 = x11, cy2 = y11; }
    } else {
        if (w1 >= w2) { cx1 = x21, cy1 = y21, cx2 = x22, cy2 = y22; } else { cx1 = x11, cy1 = y11, cx2 = x12, cy2 = y12; }
    }
    let npt1 = calcverticalvectorpoint(cx1, cy1, cx2, cy2, cx, cy);    
    cx3 = npt1.dx, cy3 = npt1.dy;
    angle = calclineangle2(cx2, cy2, cx1, cy1, 'drawcutoutmarkers');
    //if (shape.sides.length > 1) { angle = calclineangle2(cx2, cy2, cx1, cy1, 'drawcutoutmarkers'); } else { angle = calclineangle2(cx1, cy1, cx2, cy2, 'drawcutoutmarkers'); }
    let angle1 = calclineangle2(cx3, cy3, cx, cy, 'drawcutoutmarkers');   
    let ch1 = calchyplen(cx3, cy3, cx, cy);
    let ch2 = ch1 - ch/2;
    npt1 = rotate_point1(cx3, cy3, -1, angle1, ch2);
    cx1 = npt1.dx, cy1 = npt1.dy;   
    let mtx1 = Math.round(cx3), mty1 = Math.round(cy3), mtext1 = decimaltofraction(applymminchfact(cdw, 2, 2, source)) + " x" + applymminchfact(cdh, 2, 2, source);
    let mtext = applymminchfact(cw, 2, 2, source) + " x " + applymminchfact(ch, 2, 2, source);
    let mtx = Math.round(cx - 20), mty = Math.round(cy + ch / 2);
    let cshapetext = cshape != undefined ? cshape.toUpperCase() : '';
    let ctx = Math.round(cx - 20 + cshapetext.length / 2), cty = Math.round(cy + 10);
    let cmx1 = (cx1 + cx3) / 2, cmy1 = (cy1 + cy3) / 2;
    npt1 = rotate_point1(cmx1, cmy1, -1, angle, 2 * dh);
    cmx2 = npt1.dx, cmy2 = npt1.dy;
    //console.log(index, sideindex, cmtype, cmx1, cmy1, cmx2, cmy2, angle, shape.sides.length);
    if (shape.mode == 'shape') {       
        drawcutoutmarkerline(index, sideindex, 2, cx3, cy3, cx1, cy1);
        drawcutoutmarkerline1(index, sideindex, 2, cmx2, cmy2, cmx1, cmy1);
        drawcutoutmarkertext(index, sideindex, 3, mtx1, mty1, mtext1);
        drawcutoutmarkersizetext(index, sideindex, 4, mtx, mty, mtext);
        drawcutoutshapetext(index, sideindex, 4, ctx, cty, cshapetext)
    }
}
function drawcutoutcenterline(index, sideindex) {
    let source = 'drawcutoutcenterline';
    let side = shape.sides[sideindex];  
    let x1 = side.x1, y1 = side.y1, x2 = side.x2, y2 = side.y2;
    let x11 = side.x11, y11 = side.y11, x12 = side.x12, y12 = side.y12, w1 = applymminchfact(side.w1, 1, 2, source), h = applymminchfact1(side.h, 1, 2,source);
    let x21 = side.x21, y21 = side.y21, x22 = side.x22, y22 = side.y22, w2 = applymminchfact(side.w2, 1, 2, source);
    let cx1 = 0, cy1 = 0, cx2 = 0, cy2 = 0, cx3 = 0, cy3 = 0, npt1 = {};
    if (w1 >= w2) {
        cx1 = x21, cy1 = y21, cx2 = (x21 + x22) / 2; cy2 = (y21 + y22) / 2;
        npt1 = calcverticalvectorpoint(x11, y11, x12, y12, cx2, cy2);
    } else {
        cx1 = x11, cy1 = y11, cx2 = (x11 + x12) / 2; cy2 = (y11 + y12) / 2;
        npt1 = calcverticalvectorpoint(x21, y21, x22, y22, cx2, cy2);
    }    
    cx3 = npt1.dx, cy3 = npt1.dy;  
    drawcutoutmarkerline(index, sideindex, 5, cx2, cy2, cx3, cy3);
}
function drawcutoutmarkerline(index, sideindex, lncode, x1, y1, x2, y2) {
    let sindex = shape.index, smode = shape.mode;
    let cutoutmarkerg = initcutoutmarkerg(index, sideindex);  
    if (!cutoutmarkerg.empty()) {
        let cmindex = sideindex + "" + index + "" + lncode;
        let markerline = cutoutmarkerg.select("#cmline" + cmindex);
        if (markerline.empty()) { markerline = cutoutmarkerg.append("line").attr("id", "cmline" + cmindex); }
        let arrowstart = shape.mode == 'print' ? "url(#printtriangle-start)" : "url(#triangle-start)";
        let arrowend = shape.mode == 'print' ? "url(#printtriangle-end)" : "url(#triangle-end)";
        markerline.attr("x1", x1).attr("y1", y1).attr("x2", x2).attr("y2", y2).attr("class", "cutoutarrow").attr("marker-start", arrowstart).attr("marker-end", arrowend);
    }
}
function drawcutoutmarkerline1(index, sideindex, lncode, x1, y1, x2, y2) {
    if (isNaN(x1) || isNaN(y1) || isNaN(x2) || isNaN(y2)) { return;}
    //console.log(index, sideindex, lncode, x1, y1, x2, y2);
    let sindex = shape.index, smode = shape.mode;
    let cutoutmarkerg = initcutoutmarkerg(index, sideindex);   
    if (!cutoutmarkerg.empty()) {
        let cmindex = sideindex + "" + index + "" + lncode;
        let markerline = cutoutmarkerg.select("#cmline1" + cmindex);
        if (markerline.empty()) { markerline = cutoutmarkerg.append("line").attr("id", "cmline1" + cmindex); }
        let arrowstart = shape.mode == 'print' ? "url(#printtriangle-start)" : "url(#triangle-start)";
        let arrowend = shape.mode == 'print' ? "url(#printtriangle-end)" : "url(#triangle-end)";
        markerline.attr("x1", x1 ).attr("y1", y1).attr("x2", x2).attr("y2", y2).attr("class", "cutoutarrow").attr("marker-start", arrowstart).attr("marker-end", arrowend);
    }
}
function drawcutoutmarkertext(index, sideindex, lncode, x, y, mtext) {  
    let cutoutmarkerg = initcutoutmarkerg(index, sideindex);   
    if (!cutoutmarkerg.empty()) {
        let cmindex = sideindex + "" + index + "" + lncode;       
        let cmarkertext = cutoutmarkerg.select("#cmtext" + cmindex);
        if (cmarkertext.empty()) { cmarkertext = cutoutmarkerg.append("text").attr("id", "cmtext" + cmindex); }
        cmarkertext.attr("x", x).attr("y", y).text(mtext).attr("style", "fill:gray;cursor:pointer;font-size:10px");
    }    
}
function drawcutoutmarkersizetext(index, sideindex, lncode, mtx, mty, mtext) {
    let cutoutg = initcutoutmarkerg(index, sideindex);
    let cutoutmarkerg = initcutoutmarkerg(index, sideindex);
    if (!cutoutmarkerg.empty()) {
        let cmindex = sideindex + "" + index + "" + lncode;
        let cmarkertext = cutoutmarkerg.select("#cmsizetext" + cmindex);
        if (cmarkertext.empty()) { cmarkertext = cutoutmarkerg.append("text").attr("id", "cmsizetext" + cmindex); }
        cmarkertext.attr("x", mtx).attr("y", mty).text(mtext).attr("style", "fill:gray;cursor:pointer;font-size:10px");
    }
}
function drawcutoutshapetext(index, sideindex, lncode, mtx, mty, cshapetext) {
    let cutoutmarkerg = initcutoutmarkerg(index, sideindex);
    if (!cutoutmarkerg.empty()) {
        let cmindex = sideindex + "" + index + "" + lncode;        
        let cmshapetext = cutoutmarkerg.select("#cmshapetext" + cmindex);
        if (cmshapetext.empty()) { cmshapetext = cutoutmarkerg.append("text").attr("id", "cmshapetext" + cmindex); }
        cmshapetext.attr("x", mtx).attr("y", mty).text(cshapetext).attr("style", "fill:gray;cursor:pointer;font-size:10px");
    }
}
function showcutoutmarkers() {
    let mode = this.getAttribute("smode");
    let cindex = parseInt(this.getAttribute("cindex")); 
    cutoutg = cutoutsg.select("#cutoutg" + cindex);
    let csizemarkerg = cutoutg.select("#csizemarkerg" + cindex);
    csizemarkerg.style("opacity", 1);
}
function hidecutoutmarkers() {
    let cindex = parseInt(this.getAttribute("cindex"));
    let sindex = parseInt(this.getAttribute("sindex"));
    cutoutg = cutoutsg.select("#cutoutg" + cindex);
    let csizemarkerg = cutoutg.select("#csizemarkerg" + cindex);
    csizemarkerg.style("opacity", 0);
}
function cutoutdragstarted() {
    let mode = this.getAttribute("smode");
    let index = parseInt(this.getAttribute("index"));
    let sideindex = parseInt(this.getAttribute("sideindex"));
    let sindex = parseInt(this.getAttribute("sindex"));
    let spindex = parseInt(this.getAttribute("spindex"));
    let partsrno = parseInt(this.getAttribute("partsrno"));
    let areaid = parseInt(this.getAttribute("areaid"));    
    if (shape.index != sindex) { setdrawshape31(sindex, partsrno, areaid, mode, 'cutoutdragstarted'); }
    if (mode == 'shape') {      
        let side = shape.sides[sideindex];
       // console.log(mode, index, sideindex, sindex, spindex, partsrno, areaid, side.cutouts.length);
        let cutout = side.cutouts[index];        
        dragdx = d3.event.x - cutout.x; dragdy = d3.event.y - cutout.y;        
        removeshapetools();
        bdrag = true;      
    }
}
function cutoutdragged() {
    let mode = this.getAttribute("smode");
    if (bdrag && mode == 'shape') {        
        let index = parseInt(this.getAttribute("index"));
        let sideindex = parseInt(this.getAttribute("sideindex"));
        let sindex = parseInt(this.getAttribute("sindex"));              
        let side = shape.sides[sideindex];
        let cutout = side.cutouts[index];
        let cx = d3.event.x - dragdx, cy = d3.event.y - dragdy;
        cutout.x = cx; cutout.y = cy;
        onsetshapesidecutout1(cx, cy, index, sideindex, sindex);
    }  
}
function cutoutdragended() {    
    if (bdrag) {
        bdrag = false;
        setdrawmode(0);
        resetdragvars('cutoutdragended');
        ActionUpdateShape('cutoutdragended');            
    }
}

